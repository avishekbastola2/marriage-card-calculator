<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marriage Card Tracker</title>

<style>
body {
    background: #0f172a;
    color: white;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
}
.container {
    width: 90%;
    max-width: 480px;
    margin-top: 40px;
    text-align: center;
}
.card {
    background: #1e293b;
    padding: 20px;
    border-radius: 10px;
}
input {
    width: 90%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 6px;
    border: none;
}
button {
    width: 90%;
    padding: 12px;
    background: #6366f1;
    color: white;
    margin-top: 15px;
    border-radius: 6px;
    font-size: 16px;
    border: none;
}
.flag {
    width: 70px;
    margin-bottom: 10px;
}
</style>
</head>

<body>
<div class="container">

    <!-- GAME ID SCREEN -->
    <div id="gameID-screen" class="card">
        <img class="flag" src="https://upload.wikimedia.org/wikipedia/commons/9/9b/Flag_of_Nepal.png">
        <h2>Enter Game ID</h2>
        <input id="gameID" placeholder="Example: game123">
        <button onclick="startGameID()">Continue</button>
    </div>

    <!-- PLAYER SETUP SCREEN -->
    <div id="player-screen" class="card" style="display:none;">
        <h2>Add Players</h2>
        <input id="playerName" placeholder="Player Name">
        <button onclick="addPlayer()">Add Player</button>
        <p id="playerList"></p>
        <button onclick="startGame()">Start Game</button>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="card" style="display:none;">
        <h2>Game Running</h2>
        <div id="gameData"></div>
    </div>

</div>

<!-- FIREBASE IMPORTS -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyA_h1kas6HV-Lhk06sya2hsAMZmuQNAm9U",
    authDomain: "marriage-card-tracker-b9b13.firebaseapp.com",
    databaseURL: "https://marriage-card-tracker-b9b13-default-rtdb.firebaseio.com",
    projectId: "marriage-card-tracker-b9b13",
    storageBucket: "marriage-card-tracker-b9b13.appspot.com",
    messagingSenderId: "798170869634",
    appId: "1:798170869634:web:3242fd686443a4f2c2699b"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let globalGameID = "";
let players = [];

// STEP 1: ENTER GAME ID
window.startGameID = function () {
    const id = document.getElementById("gameID").value.trim();
    if (!id) return alert("Enter a Game ID");

    globalGameID = id;

    const gameRef = ref(db, "games/" + id);

    get(gameRef).then(snapshot => {
        if (snapshot.exists()) {
            const data = snapshot.val();
            players = data.players || [];
            alert("Loaded previous game!");
            showPlayerScreen();
            updatePlayerList();
        } else {
            alert("New Game Created");
            showPlayerScreen();
        }
    });
};

// STEP 2: ADD PLAYERS
window.addPlayer = function () {
    const name = document.getElementById("playerName").value.trim();
    if (!name) return;

    if (players.length >= 5) return alert("Maximum 5 players");

    players.push(name);
    updatePlayerList();
    document.getElementById("playerName").value = "";
};

function updatePlayerList() {
    document.getElementById("playerList").innerHTML =
        players.map((p, i) => (i + 1) + ". " + p).join("<br>");
}

// STEP 3: START GAME
window.startGame = function () {
    if (players.length < 2) return alert("Add at least 2 players");

    const gameRef = ref(db, "games/" + globalGameID);

    set(gameRef, {
        players: players,
        created: Date.now()
    }).then(() => {
        alert("Game Started!");
        showGameScreen();
        renderGameData();
    });
};

// HELPER FUNCTIONS
function showPlayerScreen() {
    document.getElementById("gameID-screen").style.display = "none";
    document.getElementById("player-screen").style.display = "block";
}

function showGameScreen() {
    document.getElementById("player-screen").style.display = "none";
    document.getElementById("game-screen").style.display = "block";
}

function renderGameData() {
    document.getElementById("gameData").innerHTML =
        "Game ID: " + globalGameID + "<br><br>" +
        "Players:<br>" +
        players.map(p => "â€¢ " + p).join("<br>");
}
</script>

</body>
</html>
