<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nepal Marriage Tracker</title>
    <style>
        :root { --bg: #0f172a; --panel: #1e293b; --accent: #6366f1; --win: #22c55e; --loss: #ef4444; --text: #f1f5f9; }
        body { background-color: var(--bg); color: var(--text); font-family: sans-serif; padding: 10px; margin: 0; }
        
        /* High-Fidelity Nepal Flag */
        .flag-container {
            width: 100px;
            margin: 0 auto 20px auto;
            display: block;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
        }

        .setup-card { background: var(--panel); padding: 30px; border-radius: 12px; border: 1px solid #334155; text-align: center; max-width: 600px; margin: 40px auto; }
        .table-wrap { overflow-x: auto; background: #111827; border: 1px solid #334155; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; min-width: 1200px; }
        th, td { border: 1px solid #334155; padding: 12px 8px; text-align: center; }
        th { background: #334155; color: #9ca3af; font-size: 11px; text-transform: uppercase; }
        
        .win-col { width: 140px !important; min-width: 140px; }
        .p-name { margin: 5px; width: 160px; background:#1e293b; color:white; border:1px solid #475569; padding:8px; border-radius:4px;}
        .maal-input { width: 60px; background: #fff !important; color: #000 !important; font-weight: bold; border: 2px solid var(--accent); border-radius: 4px; padding: 5px; }
        .seen-sel { width: 75px; background: #1e293b; color: white; border: 1px solid #475569; padding: 5px; border-radius: 4px; cursor: pointer; }
        .winner-sel { width: 120px; font-weight: bold; color: #facc15; background: #1e293b; border: 1px solid #475569; padding: 5px; border-radius: 4px; }
        
        .pos { color: var(--win); font-weight: bold; }
        .neg { color: var(--loss); font-weight: bold; }
        .footer-row { background: #000; font-size: 1.2rem; border-top: 4px solid var(--accent); }
        button { padding: 12px 30px; cursor: pointer; background: var(--accent); color: white; border: none; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="setup-card" id="setup">
        <svg class="flag-container" viewBox="0 0 320 380" xmlns="http://www.w3.org/2000/svg">
            <path fill="#003893" d="M0 0v380h240l-160-190h160L0 0z"/>
            <path fill="#dc143c" d="M12 25v150h175l-130-155zM12 198v165h175l-130-155z"/>
            <circle fill="#fff" cx="55" cy="115" r="25"/>
            <circle fill="#dc143c" cx="55" cy="105" r="25"/>
            <circle fill="#fff" cx="55" cy="285" r="22"/>
        </svg>
        
        <h2 style="margin-top:0;">Marriage Card Tracker <BR> by AVISHEK BASTOLA</h2>
        <div style="margin-bottom:20px;">
            <label>Rate: </label>
            <input type="number" id="rate" value="10" style="width:70px; background:#0f172a; color:white; border:1px solid #475569; padding:8px; border-radius:4px;">
        </div>
        <div id="player-inputs">
            <input type="text" class="p-name" placeholder="Name 1">
            <input type="text" class="p-name" placeholder="Name 2">
            <input type="text" class="p-name" placeholder="Name 3">
            <input type="text" class="p-name" placeholder="Name 4">
            <input type="text" class="p-name" placeholder="Name 5">
        </div>
        <br>
        <button onclick="start()">CREATE SCOREBOARD</button>
    </div>

    <div id="game-area" style="display:none;" class="table-wrap">
        <table id="scoreTable"></table>
        <div style="padding: 20px; text-align: center;">
            <button onclick="location.reload()" style="background:#475569;">RESET GAME</button>
        </div>
    </div>

<script>
    let players = [];
    let rate = 10;

    function start() {
        rate = Number(document.getElementById('rate').value) || 10;
        document.querySelectorAll('.p-name').forEach(i => { if(i.value.trim()) players.push(i.value.trim()); });
        if(players.length < 2) return alert("Please enter names!");
        
        document.getElementById('setup').style.display = 'none';
        document.getElementById('game-area').style.display = 'block';
        
        let table = document.getElementById('scoreTable');
        let h1 = `<tr><th style="width:50px">RD</th><th class="win-col">WINNER</th>`;
        players.forEach(p => h1 += `<th colspan="3" style="border-left:3px solid #6366f1;">${p}</th>`);
        h1 += `<th>TOTAL MAAL</th></tr>`;
        
        let h2 = `<tr><td></td><td></td>`;
        players.forEach(() => h2 += `<td>Maal</td><td>Seen</td><td>Cash</td>`);
        h2 += `<td></td></tr>`;
        
        table.innerHTML = h1 + h2;

        for(let r=1; r<=10; r++) {
            let row = table.insertRow();
            row.insertCell().innerText = r;
            let winCell = row.insertCell();
            winCell.className = "win-col";
            let sel = `<select class="winner-sel" onchange="calc(${r})">`;
            sel += `<option value="-1">SELECT</option>`;
            players.forEach((p, i) => sel += `<option value="${i}">${p}</option>`);
            winCell.innerHTML = sel + `</select>`;

            players.forEach(() => {
                row.insertCell().innerHTML = `<input type="number" class="maal-input" oninput="calc(${r})">`;
                row.insertCell().innerHTML = `<select class="seen-sel" onchange="calc(${r})"><option value="yes">YES</option><option value="no">NO</option></select>`;
                let c = row.insertCell(); c.innerText = "0"; c.className = "cash-cell";
            });
            let tm = row.insertCell(); tm.innerText = "0"; tm.className = "tm-cell";
        }

        let foot = table.insertRow(); 
        foot.className = "footer-row";
        foot.innerHTML = `<td colspan="2">SESSION TOTAL CASH</td>` + 
                         players.map(() => `<td colspan="3" class="g-total">0</td>`).join('') + 
                         `<td>-</td>`;
    }

    function calc(r) {
        let table = document.getElementById('scoreTable');
        let row = table.rows[r+1];
        let winIdx = parseInt(row.cells[1].querySelector('select').value);
        if (winIdx === -1) return;

        let totalMaal = 0;
        let stats = players.map((_, i) => {
            let m = parseInt(row.cells[2 + i*3].querySelector('input').value) || 0;
            let s = row.cells[3 + i*3].querySelector('select').value;
            if(s === "yes") totalMaal += m;
            return { m, s };
        });

        let othersTotalCash = 0;
        players.forEach((_, i) => {
            if(i === winIdx) return;
            let cash = (stats[i].s === "no") ? -((totalMaal + 10) * rate) : ((stats[i].m * players.length) - (totalMaal + 3)) * rate;
            let cCell = row.cells[4 + i*3];
            cCell.innerText = Math.round(cash);
            cCell.className = "cash-cell " + (cash >= 0 ? "pos" : "neg");
            othersTotalCash += cash;
        });

        let wCell = row.cells[4 + winIdx*3];
        let winCash = -othersTotalCash;
        wCell.innerText = Math.round(winCash);
        wCell.className = "cash-cell " + (winCash >= 0 ? "pos" : "neg");
        
        row.cells[row.cells.length-1].innerText = totalMaal;
        updateGrandTotals();
    }

    function updateGrandTotals() {
        const table = document.getElementById('scoreTable');
        const rows = table.rows;
        const footer = rows[rows.length - 1];
        players.forEach((_, pIdx) => {
            let sum = 0;
            for(let rIdx = 2; rIdx < rows.length - 1; rIdx++) {
                sum += Number(rows[rIdx].cells[4 + pIdx * 3].innerText) || 0;
            }
            let targetCell = footer.cells[1 + pIdx];
            targetCell.innerText = sum;
            targetCell.className = "g-total " + (sum >= 0 ? "pos" : "neg");
        });
    }
</script>
</body>
</html>

